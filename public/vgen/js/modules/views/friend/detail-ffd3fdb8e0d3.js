(function(){var e="models/extension";define("models/extension",[],function(){log(e,"Dependencies loaded","Build module");var t=Backbone.Model.extend({idAttribute:"_id",urlRoot:function(){return"/api/friends/"+this.friend_id+"/extensions"},defaults:{name:"",tags:[],content:""}});return t})})(),function(){var e="collections/extensions";define("collections/extensions",["models/extension"],function(t){log(e,"Dependencies loaded","Build module");var n=Backbone.Collection.extend({model:t,url:function(){return console.log("COLLECTION URL called",this.options,this.options.friend_id),"/api/friends/"+this.options.friend_id+"/extensions"},initialize:function(e,t){this.friend=t.friend}});return n})}(),function(){var e="models/friend";define("models/friend",["collections/extensions"],function(t){log(e,"Dependencies loaded","Build module");var n=Backbone.Model.extend({idAttribute:"_id",urlRoot:"/api/friends",defaults:{extensions:[],fb_id:null,user_id:null,name:null,picture:null,picture_small:null},parse:function(e){return e.extensions=new t(e.extensions,{friend:this}),e},addExtension:function(e){this.get("extensions").add(e)}});return n})}();var jd_rt="jade-runtime";define("templates/extension/item",[jd_rt],function(){return function(e){var t=[],n=e||{},r=n.extension;return t.push('<div class="extension_name">Name: '+jade.escape((jade.interp=r.name)==null?"":jade.interp)+'</div><div class="extension_tags">Tags: '+jade.escape((jade.interp=r.tags)==null?"":jade.interp)+'</div><div class="extension_content">Content: '+jade.escape((jade.interp=r.content)==null?"":jade.interp)+'</div><div class="tools"><button class="button red js-remove_extension">Remove</button></div>'),t.join("")}}),function(){var e="views/extension/item";define("views/extension/item",["templates/extension/item"],function(t){log(e,"Dependencies loaded","Build module");var n=Backbone.View.extend({tagName:"li",className:"extension list-item",events:{"click .js-remove_extension":"delete"},"delete":function(e){var t=this;e.stopPropagation(),confirm("Are you sure you want to delete this extension?")&&this.model.destroy({success:function(){t.remove()},error:function(){console.log("ERROR!")}})},render:function(){return this.$el.attr("data-id",this.model.id).html(t({extension:this.model.attributes})),this}});return n})}(),function(){var e="views/extension/list",t="facebook";define("views/extension/list",[t,"views/extension/item"],function(t,n){log(e,"Dependencies loaded","Build module");var r=Backbone.View.extend({tagName:"ul",className:"extensions",events:{},render:function(){var e=this,t=$.Deferred(),r=this.collection.friend,i=[];return this.collection.each(function(t){t.friend_id=r.id,i.push(e.renderChild(new n({model:t,friend:r})))}),$.when.apply($,i).then(function(){t.resolve()}),t},add:function(t){log(e,"Update extension list",t),this.renderChild(new n({model:t,friend:this.collection.friend}),{meth:"append",target:".extensions"})},beforeRemove:function(e){return this.collection.off("add",this.getAddProxy()),this},getAddProxy:function(){return this.addProxy||(this.addProxy=$.proxy(this.add,this))},initialize:function(){this.collection.on("add",this.getAddProxy())}});return r})}();var jd_rt="jade-runtime";define("templates/extension/create",[jd_rt],function(){return function(e){var t=[];return t.push('<h4>Add an extension</h4><div class="input_container"><input type="text" name="extension_name" placeholder="name"/></div><div class="input_container"><input type="text" name="extension_content" placeholder="content"/></div><div class="input_container"><input type="text" name="extension_tags" placeholder="tags (comma separated: ex: yo, fun and magic)"/></div><div class="submit_container"><input type="submit"/></div>'),t.join("")}}),function(){var e="views/extension/create",t="facebook";define("views/extension/create",[t,"models/extension","templates/extension/create"],function(t,n,r){log(e,"Dependencies loaded","Build module");var i=Backbone.View.extend({tagName:"form",className:"add_extension_form",name:"extension_form",events:{submit:"createExtension"},createExtension:function(e){e.preventDefault();var t=new n({name:document.extension_form.extension_name.value,tags:document.extension_form.extension_tags.value,content:document.extension_form.extension_content.value}),r=this;t.friend_id=this.options.friend.id,t.save(null,{success:function(e){r.options.friend.addExtension(e),r.reset()}})},reset:function(){this.el.reset(),this.$el.find("input:first").focus()},render:function(e){return this.$el.attr("name",this.name).html(r()),this}});return i})}(),function(){var e="views/generic";define("views/generic",[],function(){log(e,"Dependencies loaded","Build module");var t=Backbone.View.extend({name:e,render:function(){this.$el.html(this.options.template(this.options.data))}});return t})}();var jd_rt="jade-runtime";define("templates/extension/count",[jd_rt],function(){return function(e){var t=[],n=e||{},r=n.extensions,i=r.length;t.push('<div class="fgd2 small it extensions_sum">');switch(i){case 0:t.push("- no extensions yet -");break;case 1:t.push('- <span class="extensions_count">1</span> extension -');break;default:t.push('- <span class="extensions_count">'+jade.escape((jade.interp=i)==null?"":jade.interp)+"</span> extensions -")}return t.push("</div>"),t.join("")}}),function(){var e="views/friend/extension-count";define("views/extension/count",["templates/extension/count"],function(t){log(e,"Dependencies loaded","Build module");var n=Backbone.View.extend({name:e,render:function(){this.$el.html(t({extensions:this.collection}))},beforeRemove:function(e){return this.collection.off("add remove",this.getRenderProxy()),this},getRenderProxy:function(){return this.renderProxy||(this.renderProxy=$.proxy(this.render,this))},initialize:function(e){this.collection.on("add remove",this.getRenderProxy())}});return n})}();var jd_rt="jade-runtime";define("templates/friend/name-and-picture",[jd_rt],function(){return function(e){var t=[],n=e||{},r=n.friend,i=r.get("fb_id");return t.push("<div"+jade.attrs({"data-uid":""+i+"","data-id":""+r.id+"","class":["friend"]},{"data-uid":!0,"data-id":!0})+'><div class="big_pic"><img'+jade.attrs({src:""+r.get("picture")+""},{src:!0})+'/></div><h2 class="name">'+jade.escape(null==(jade.interp=r.get("name"))?"":jade.interp)+"</h2></div>"),t.join("")}}),function(){var e="views/friend/detail-top";define("views/friend/detail-top",["views/generic","views/extension/count","templates/friend/name-and-picture"],function(t,n,r){log(e,"Dependencies loaded","Build module");var i=Backbone.View.extend({name:e,render:function(){var i=$.Deferred(),s=this;log(e,"render");var o=new t({template:r,data:{friend:s.model}}),u=new n({collection:s.model.get("extensions")}),a=s.renderChild(o),f=s.renderChild(u);return $.when.apply([a,f]).then(function(){i.resolve()}),i}});return i})}(),function(){var e="views/friend/detail",t="pubsub",n="facebook";define("views/friend/detail",[t,n,"models/friend","views/extension/list","views/extension/create","views/friend/detail-top"],function(t,n,r,i,s,o){log(e,"Dependencies loaded","Build module");var u=Backbone.View.extend({name:e,render:function(){t.publish("header:any");var n=$.Deferred(),r=this;return log(e,"render"),this.dataPromise.done(function(){var e=new o({model:r.model}),t=new s({friend:r.model}),u=new i({collection:r.model.get("extensions")}),a=r.renderChild(e),f=r.renderChild(u),l=r.renderChild(t);$.when(a,f,l).then(function(){n.resolve()})}),n},initialize:function(e){var t=e.routeParameters[0],n=this;this.dataPromise=(new r({_id:t})).fetch({success:function(e){n.model=e}})}});return u})}();