(function(){var e="views/candidate/results",t="facebook";define([t,"models/friend","views/candidate/item","views/candidate/empty"],function(t,n,r,i){log(e,"Dependencies loaded","Build module");var s=Backbone.View.extend({name:e,tagName:"ul",id:"fb_search_results",search:"",UIDs:[],results:[],events:{},setSearch:function(e){return this.search=e,this},setResults:function(e){return this.results=e,this},empty:function(){this.$el.empty(),this.UIDs=[],this.results=[]},update:function(){log(e,"result",this.results,"search",this.search);if(!this.search){this.clean(),this.empty();return}this.needFBRendering=!0;var t=!1,s=this,o=_.map(this.results,function(e){return e.uid});log(e,"resultUIDs",o);if(!this.results.length)log(e,"results empty"),this.clean().renderChild(new i({search:this.search}),{meth:"html",target:this.$el}),this.needFBRendering=!1;else{log(e,"has results");var u=[],a=[],f=[];log(e,"current UIDS",this.UIDs),this.UIDs.length?(log(e,"children",this.children.length,"resultUIDs",o),_.each(this.children,function(t){log(e,"child",t,t.model);if(t.model){var n=t.model.get("fb_id");log(e,"UID",n,o.indexOf(n)),o.indexOf(n)==-1?(log(e,t.model.get("name"),"not present in results, remove it"),a.push(t),s.UIDs.splice(s.UIDs.indexOf(n),1)):(log(e,t.model.get("name"),"already present"),f.push(n))}})):(log(e,"CLEAR current result content."),this.clean().$el.empty()),_.each(a,function(e){e.remove()});var u=_.difference(o,f);u.length&&(_.each(this.results,function(t){if(u.indexOf(t.uid)==-1)return;log(e,"add child",t),s.renderChild(new r({model:new n({fb_id:t.uid,name:t.name,picture:t.pic_big,picture_small:t.pic_square})}),{meth:"prepend",target:s.$el})}),this.needFBRendering=!0)}this.UIDs=o},render:function(){var t=this,s=$.Deferred(),o=[];if(!this.results.length)log(e,"results empty"),o.push(this.renderChild(new i({search:this.search}))),this.needFBRendering=!1;else{var u=_.map(this.results,function(e){return e.uid});_.each(this.results,function(e){o.push(t.renderChild(new r({model:new n({fb_id:e.uid,name:e.name,picture:e.pic_big,picture_small:e.pic_square})})))}),this.UIDs=u,this.needFBRendering=!0}return $.when.apply($,o).then(function(){s.resolve()}),s}});return s})})();