(function(e){var t="session",n="pubsub",r="facebook";define("session",[n,r],function(e,n){log(t,"Dependencies loaded","Build module");var r=function(){e.subscribe("facebook:status",this.onFacebookStatus,this)},i=!1;return r.prototype={logged:function(){return i},requireAuth:function(t){i?t():e.publish("session:status",i)},toggleLoginStatus:function(e){n.toggleLoginStatus()},onFacebookStatus:function(n){i=n=="connected",e.publish("session:status",i),log(t,"onFacebookStatus - reader is logged?",i)}},new r})})(window),function(){var e="views/header",t="pubsub",n="session";define("views/header",[n,t],function(t,n){log(e,"Dependencies loaded","Build module");var r=Backbone.View.extend({name:e,permanent:!0,currentDisplayMode:"hidden",events:{"click button.js-auth_button":"onAuthClick"},onAuthClick:function(e){t.toggleLoginStatus()},displayForLogin:function(){if(this.currentDisplayMode!="login"){$(".js-add_fb_friend").hide();var e=$(".js-auth_button");e.show().html(e.data("in"))}},displayForAny:function(){if(this.currentDisplayMode!="any"){$(".js-add_fb_friend").show();var e=$(".js-auth_button");e.show().html(e.data("out"))}},initialize:function(){n.subscribe("header:login",this.displayForLogin,this).subscribe("header:any",this.displayForAny,this)}});return r})}(),function(){var e="views/app";define("views/app",["session","views/header"],function(t,n){log(e,"Dependencies loaded","Build module");var r=Backbone.View.extend({initialized:!1,name:e,render:function(){log(e,"render AppView"),this.initialized||(this.initialized=!0,this.renderChild(new n({el:$("header")})));var t=this,r=Array.prototype.slice.call(this.pageArgs),i=r[0];log(e,"render Page",i),require([i],function(e){t.renderChild(new e({routeParameters:r.slice(1)}),{meth:"html",target:"#pages"})})},renderPage:function(){this.pageArgs=arguments,this.clean(),this.render()},renderAuthPage:function(){var e=this,n=arguments;t.requireAuth(function(){e.renderPage.apply(e,n)})}});return r})}(),function(){var e="router",t="pubsub";define("router",["session",t,"views/app"],function(t,n,r){log(e,"Dependencies loaded","Build module");var i=Backbone.Router.extend({routes:{"friend/:id":"getFriend",login:"login",add:"add","test-renderer":"testRenderer","*actions":"any"},needReload:function(){return $.cookie("iacv")!=window.IAC_VERSION?!0:!1},reload:function(){document.location.reload()}}),s=function(){var e=new r({el:$("#pages")}),s=new i;window.app=s,n.subscribe("session:status",function(e){e?s.navigate("/",{trigger:!0}):s.navigate("login",{trigger:!0})}),s.on("route:any",function(){e.renderAuthPage("views/home")}),s.on("route:add",function(t){e.renderAuthPage("views/friend/add")}),s.on("route:login",function(){if(t.logged())return s.navigate("/",{trigger:!0});e.renderPage("views/login")}),s.on("route:getFriend",function(t){e.renderAuthPage("views/friend/detail",t)}),s.on("route:testRenderer",function(){e.renderPage("views/test/page")}),Backbone.history.start()};return{initialize:s}})}(),function(){var e="facebook",t="pubsub";define("facebook",[t],function(t){log(e,"Dependencies loaded","Build module");var n=function(){};return n.prototype={init:function(e){this.readyCallback=e,window.fbAsyncInit=$.proxy(this.asyncInit,this),function(e){var t,n="facebook-jssdk",r=e.getElementsByTagName("script")[0];if(e.getElementById(n))return;t=e.createElement("script"),t.id=n,t.async=!0,t.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(t,r)}(document)},initialized:function(){return this.FbInitialized},asyncInit:function(){var e=this;FB.init({appId:window.FB_APP_ID,channelUrl:"//"+window.FB_APP_DOMAIN+"/channel.html",status:!1,cookie:!0,xfbml:!1}),this.FbInitialized=!0,FB.getLoginStatus(function(t){t.status=="unknown"&&e.subscribeToStatusChange(),e.sendUpdateSignal(t.status),e.readyCallback()})},toggleLoginStatus:function(){var e=this;FB.getLoginStatus(function(t){t.status==="connected"?e.logout():e.login()})},login:function(){FB.login(function(e){t.publish("facebook:status",e.status)})},logout:function(){FB.logout(function(e){t.publish("facebook:status",e.status)})},sendUpdateSignal:function(e){t.publish("facebook:status",e)},subscribeToStatusChange:function(){if(arguments.callee.done)return;arguments.callee.done=!0,FB.Event.subscribe("auth.statusChange",$.proxy(this.onFbStatusChange,this))},onFbStatusChange:function(e){this.sendUpdateSignal(e.status)},render:function(e){FB.XFBML.parse(e)},searchFriend:function(e,t){if(!e)return t(e);FB.api({method:"fql.query",query:'SELECT uid, name, pic_square, pic_big FROM user WHERE uid IN ( SELECT uid2 FROM friend WHERE uid1 = me() ) AND ( strpos(lower(name),"'+e.toLowerCase()+'") >= 0 '+")"},function(n){t(e,n)})},getFriendsInfos:function(e,t){FB.api({method:"fql.query",query:"SELECT uid, name, pic_square FROM user WHERE uid IN ("+e.join(",")+")"},t)}},new n})}(),function(e){var t="pubsub";define("pubsub",[],function(){log(t,"Build module");var n={},r=null,i=function(){};return i.prototype={subscribe:function(t,r,i){return(n[t]=n[t]||[]).push([i||e,r]),this},unsubscribe:function(e,t){for(var r=(n[e]||[]).length,i=r-1;i>=0;i--)t===n[e][i][1]&&n[e].splice(i,1);return this},publish:function(e){for(var t=0,r=(n[e]||[]).length;t<r;t++)n[e][t][1].apply(n[e][t][0],Array.prototype.slice.call(arguments,1));return this}},new i})}(window),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("jade-runtime",e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.jade=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function r(e){return e!=null&&e!==""}function i(e){return Array.isArray(e)?e.map(i).filter(r).join(" "):e}n.merge=function s(e,t){if(arguments.length===1){var n=e[0];for(var i=1;i<e.length;i++)n=s(n,e[i]);return n}var o=e["class"],u=t["class"];if(o||u)o=o||[],u=u||[],Array.isArray(o)||(o=[o]),Array.isArray(u)||(u=[u]),e["class"]=o.concat(u).filter(r);for(var a in t)a!="class"&&(e[a]=t[a]);return e},n.joinClasses=i,n.cls=function(t,r){var s=[];for(var o=0;o<t.length;o++)r&&r[o]?s.push(n.escape(i([t[o]]))):s.push(i(t[o]));var u=i(s);return u.length?' class="'+u+'"':""},n.attr=function(t,r,i,s){return"boolean"==typeof r||null==r?r?" "+(s?t:t+'="'+t+'"'):"":0==t.indexOf("data")&&"string"!=typeof r?" "+t+"='"+JSON.stringify(r).replace(/'/g,"&apos;")+"'":i?" "+t+'="'+n.escape(r)+'"':" "+t+'="'+r+'"'},n.attrs=function(t,r){var s=[],o=Object.keys(t);if(o.length)for(var u=0;u<o.length;++u){var a=o[u],f=t[a];"class"==a?(f=i(f))&&s.push(" "+a+'="'+f+'"'):s.push(n.attr(a,f,!1,r))}return s.join("")},n.escape=function(t){var n=String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return n===""+t?t:n},n.rethrow=function o(t,n,r,i){if(t instanceof Error){if((typeof window!="undefined"||!n)&&!i)throw t.message+=" on line "+r,t;try{i=i||e("fs").readFileSync(n,"utf8")}catch(s){o(t,null,r)}var u=3,a=i.split("\n"),f=Math.max(r-u,0),l=Math.min(a.length,r+u),u=a.slice(f,l).map(function(e,t){var n=t+f+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+u+"\n\n"+t.message,t}throw t}},{fs:2}],2:[function(e,t,n){},{}]},{},[1])(1)}),function(){var e="application";define("application",["router","facebook","pubsub","jade-runtime"],function(t,n){log(e,"Dependencies loaded","Build module");var r=function(){};return r.prototype={initialize:function(){log(e,"initialize");var r=this;$(function(){log(e,"Facebook.init"),n.init(function(){log(e,"Facebook.init - DONE"),log(e,"Router.initialize"),t.initialize()})})}},new r})}(),log("main",'require "application"'),Backbone.renderTreeUID=0,Backbone.Renderer=function(){this.trees={},this.postRenderer=new Backbone.postRenderer},Backbone.Renderer.prototype={add:function(e,t){log("Renderer","add",e.name,e.cid,"with parent:",e.parent.name);var n=e.parent.renderId||++Backbone.renderTreeUID,r=this;this.trees[n]&&this.trees[n].rendered&&(log("Renderer","parent renderTree has already been rendered, get a new one."),n=++Backbone.renderTreeUID),this.trees[n]||(log("Renderer","No render tree for renderId",n,"build new tree."),this.trees[n]={rendered:!1,fragment:document.createDocumentFragment(),initiatorCid:e.parent.cid}),e.renderId=n,e.postRender&&this.postRenderer.register(e),log("Renderer","current renderId",n);var i=e.render();return log("Renderer","render",e.name,"called. return value:",i),e.el.parentNode?log("Renderer",e.name,"element is already attached"):(log("Renderer",e.name,"element has no parentNode"),e.parent.cid==this.trees[e.renderId].initiatorCid?(log("Renderer","### TOP level child",e.name,". Put",e.el,"in a fragment for later appending"),this.trees[e.renderId].fragment.appendChild(e.el)):(log("Renderer","### LOWER level child",e.name,". Appending",e.el,"to parent",e.parent),e.parent.$el.append(e.el)),$.when(i).then(function(){log("Renderer","!!!!!!!!!!! promise fulfilled for",e.name,e.renderId);if(r.trees[e.renderId]&&e.parent.cid==r.trees[e.renderId].initiatorCid){if(window.reloading)return;log("Renderer","**************************************",e.el),t?(log("Renderer","************************************** HOW",t),$(t.target)[t.meth](r.trees[e.renderId].fragment)):e.parent.$el.append(r.trees[e.renderId].fragment),r.postRenderer.run(e.renderId),r.trees[e.renderId].rendered=!0,delete r.trees[e.renderId].fragment}})),i}},Backbone.postRenderer=function(){},Backbone.postRenderer.prototype={postRenderRegistry:{},register:function(e){this.postRenderRegistry[e.renderId]||(this.postRenderRegistry[e.renderId]={}),this.postRenderRegistry[e.renderId][e.cid]=e},remove:function(e){this.postRenderRegistry[e.renderId]&&this.postRenderRegistry[e.renderId][e.cid]&&delete this.postRenderRegistry[e.renderId][e.cid]},run:function(e){if(!this.postRenderRegistry[e])return;var t;for(viewCid in this.postRenderRegistry[e])this.postRenderRegistry[e][viewCid].postRender()}},window.renderer=new Backbone.Renderer,Backbone.View=Backbone.View.extend({renderChild:function(e,t){log("Main","renderChild",e.cid,e.name),e.parent=this;var n=this;return this.children||(this.children=[]),this.children.push(e),renderer.add(e,t)},beforeRemoveChildren:function(){log("Main","beforeRemoveChildren",this.cid,this.name);if(!this.children||!this.children.length)return log("Main",this.cid,"no child to remove"),this;for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];if(n.permanent){log("Main",n.cid,"is permanent. Skip pre-remove process.");continue}log("Main",this.cid,"clean child",n.cid,n.name),n.beforeRemoveChildren().beforeRemove().undelegateEvents()}return this},beforeRemove:function(){return this},clean:function(){return log("Main","clean",this.cid,this.name),this.beforeRemoveChildren(),delete this.children,this},remove:function(){var e=Backbone.View.prototype.remove;return function(){if(this.permanent){log("Main",this.cid,"is permanent. Cannot remove it.");return}return this.beforeRemoveChildren(),this.parent&&this.parent.children&&this.parent.children.splice(this.parent.children.indexOf(this),1),e.apply(this,arguments),this}}()}),function(){var e=function(e,t){var n=e.prototype[t];return function(){return this.on("sync error",function(){app.needReload()&&(window.reloading=!0,app.reload())}),n.apply(this,arguments),this}};Backbone.Model=Backbone.Model.extend({initialize:e(Backbone.Model,"initialize")}),Backbone.Collection=Backbone.Collection.extend({initialize:e(Backbone.Collection,"initialize")})}(),require(["application"],function(e){log("main","Application.initialize"),e.initialize()}),define("main",function(){});